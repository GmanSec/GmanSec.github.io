
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://gmansec.github.io/CTF%20Write-ups/SANS%20Holiday%20Hack%20Challenge/2024/Act%203/Elf%20Stack/">
      
      
        <link rel="prev" href="../Santa%20Vision/">
      
      
        <link rel="next" href="../Decrypt%20Frostbit/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Elf Stack - GmanSec</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hint-1-elf-stack-intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="GmanSec" class="md-header__button md-logo" aria-label="GmanSec" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GmanSec
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Elf Stack
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../blog/" class="md-tabs__link">
        
  
    
  
  Blog

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  CTF Write-ups

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="GmanSec" class="md-nav__button md-logo" aria-label="GmanSec" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GmanSec
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    CTF Write-ups
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            CTF Write-ups
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SANS Holiday Hack Challenge
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            SANS Holiday Hack Challenge
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../CTF Write-ups/SANS Holiday Hack Challenge/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2024
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            2024
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2_2_2" id="__nav_2_2_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Act 3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2_2_2">
            <span class="md-nav__icon md-icon"></span>
            Act 3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Act III
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Santa%20Vision/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Santa Vision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Elf Stack
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Elf Stack
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hint-1-elf-stack-intro" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 1 - Elf Stack Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-2-elf-stack-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 2 - Elf Stack Fields
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-3-elf-stack-winevent" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 3 - Elf Stack WinEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-4-elf-stack-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 4 - Elf Stack PowerShell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-5-elf-stack-hard-email1" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 5 - Elf Stack Hard - Email1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-6-elf-stack-hard-email2" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 6 - Elf Stack Hard - Email2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-to-the-challenge-environment-set-up" class="md-nav__link">
    <span class="md-ellipsis">
      Access to the Challenge - Environment set up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-silver-easy-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Solution - Silver (Easy Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution - Silver (Easy Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2" class="md-nav__link">
    <span class="md-ellipsis">
      Question 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3" class="md-nav__link">
    <span class="md-ellipsis">
      Question 3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-4" class="md-nav__link">
    <span class="md-ellipsis">
      Question 4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-5" class="md-nav__link">
    <span class="md-ellipsis">
      Question 5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-6" class="md-nav__link">
    <span class="md-ellipsis">
      Question 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-7" class="md-nav__link">
    <span class="md-ellipsis">
      Question 7
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-8" class="md-nav__link">
    <span class="md-ellipsis">
      Question 8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-9" class="md-nav__link">
    <span class="md-ellipsis">
      Question 9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-10" class="md-nav__link">
    <span class="md-ellipsis">
      Question 10
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-11" class="md-nav__link">
    <span class="md-ellipsis">
      Question 11
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-12" class="md-nav__link">
    <span class="md-ellipsis">
      Question 12
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-13" class="md-nav__link">
    <span class="md-ellipsis">
      Question 13
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-14" class="md-nav__link">
    <span class="md-ellipsis">
      Question 14
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-15" class="md-nav__link">
    <span class="md-ellipsis">
      Question 15
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-gold-hard-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Solution - Gold (Hard Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution - Gold (Hard Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-4_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-5_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-6_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-7_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 7
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-8_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-9_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-10_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 10
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-11_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 11
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-12_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 12
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-13_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 13
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-14_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 14
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-15_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 15
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-16" class="md-nav__link">
    <span class="md-ellipsis">
      Question 16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-17" class="md-nav__link">
    <span class="md-ellipsis">
      Question 17
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-18" class="md-nav__link">
    <span class="md-ellipsis">
      Question 18
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-19" class="md-nav__link">
    <span class="md-ellipsis">
      Question 19
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-20" class="md-nav__link">
    <span class="md-ellipsis">
      Question 20
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-21" class="md-nav__link">
    <span class="md-ellipsis">
      Question 21
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-22" class="md-nav__link">
    <span class="md-ellipsis">
      Question 22
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-23" class="md-nav__link">
    <span class="md-ellipsis">
      Question 23
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-24" class="md-nav__link">
    <span class="md-ellipsis">
      Question 24
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-message-from-fitzy-shortstack" class="md-nav__link">
    <span class="md-ellipsis">
      Final Message from Fitzy Shortstack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenge-answers-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge Answers Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Decrypt%20Frostbit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decrypt Frostbit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Deactivate%20Frostbit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deactivate Frostbit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hint-1-elf-stack-intro" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 1 - Elf Stack Intro
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-2-elf-stack-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 2 - Elf Stack Fields
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-3-elf-stack-winevent" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 3 - Elf Stack WinEvent
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-4-elf-stack-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 4 - Elf Stack PowerShell
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-5-elf-stack-hard-email1" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 5 - Elf Stack Hard - Email1
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hint-6-elf-stack-hard-email2" class="md-nav__link">
    <span class="md-ellipsis">
      Hint 6 - Elf Stack Hard - Email2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-to-the-challenge-environment-set-up" class="md-nav__link">
    <span class="md-ellipsis">
      Access to the Challenge - Environment set up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-silver-easy-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Solution - Silver (Easy Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution - Silver (Easy Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2" class="md-nav__link">
    <span class="md-ellipsis">
      Question 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3" class="md-nav__link">
    <span class="md-ellipsis">
      Question 3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-4" class="md-nav__link">
    <span class="md-ellipsis">
      Question 4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-5" class="md-nav__link">
    <span class="md-ellipsis">
      Question 5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-6" class="md-nav__link">
    <span class="md-ellipsis">
      Question 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-7" class="md-nav__link">
    <span class="md-ellipsis">
      Question 7
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-8" class="md-nav__link">
    <span class="md-ellipsis">
      Question 8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-9" class="md-nav__link">
    <span class="md-ellipsis">
      Question 9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-10" class="md-nav__link">
    <span class="md-ellipsis">
      Question 10
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-11" class="md-nav__link">
    <span class="md-ellipsis">
      Question 11
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-12" class="md-nav__link">
    <span class="md-ellipsis">
      Question 12
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-13" class="md-nav__link">
    <span class="md-ellipsis">
      Question 13
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-14" class="md-nav__link">
    <span class="md-ellipsis">
      Question 14
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-15" class="md-nav__link">
    <span class="md-ellipsis">
      Question 15
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution-gold-hard-mode" class="md-nav__link">
    <span class="md-ellipsis">
      Solution - Gold (Hard Mode)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Solution - Gold (Hard Mode)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#question-1_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-2_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-3_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 3
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-4_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 4
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-5_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 5
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-6_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 6
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-7_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 7
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-8_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 8
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-9_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 9
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-10_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 10
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-11_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 11
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-12_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 12
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-13_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 13
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-14_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 14
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-15_1" class="md-nav__link">
    <span class="md-ellipsis">
      Question 15
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-16" class="md-nav__link">
    <span class="md-ellipsis">
      Question 16
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-17" class="md-nav__link">
    <span class="md-ellipsis">
      Question 17
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-18" class="md-nav__link">
    <span class="md-ellipsis">
      Question 18
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-19" class="md-nav__link">
    <span class="md-ellipsis">
      Question 19
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-20" class="md-nav__link">
    <span class="md-ellipsis">
      Question 20
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-21" class="md-nav__link">
    <span class="md-ellipsis">
      Question 21
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-22" class="md-nav__link">
    <span class="md-ellipsis">
      Question 22
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-23" class="md-nav__link">
    <span class="md-ellipsis">
      Question 23
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#question-24" class="md-nav__link">
    <span class="md-ellipsis">
      Question 24
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-message-from-fitzy-shortstack" class="md-nav__link">
    <span class="md-ellipsis">
      Final Message from Fitzy Shortstack
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenge-answers-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Challenge Answers Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<div style="text-align: center; font-size: 2em; font-weight: bold; color: black; margin-bottom: 20px;">
    Elf Stack - Fitzy Shortstack
</div>

<style>
div.conversation {
  background-color: #f4f4f4;
  border: 1px solid #ddd;
  border-radius: 5px;
  padding: 15px;
  margin: 20px 0;
  line-height: 1.6;
  white-space: pre-wrap; /* Ensures text wraps properly */
  font-family: Arial, sans-serif;
}
</style>

<p>Our host today is Fitzy Shortstack, and this is what he has to tell us:</p>
<p><img alt="Fitzy Shortstack Conversation" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Fitzy%20Shortstack-1.png" /></p>
<p>We get the following hints after our chat with Fitzy:</p>
<h2 id="hint-1-elf-stack-intro">Hint 1 - Elf Stack Intro</h2>
<p>I'm part of the ElfSOC that protects the interests here at the North Pole. We built the Elf Stack SIEM, but not everybody uses it. Some of our senior analysts choose to use their command line skills, while others choose to deploy their own solution. Any way is possible to hunt through our logs!</p>
<h2 id="hint-2-elf-stack-fields">Hint 2 - Elf Stack Fields</h2>
<p>If you are using your command line skills to solve the challenge, you might need to review the configuration files from the containerized Elf Stack SIEM.</p>
<h2 id="hint-3-elf-stack-winevent">Hint 3 - Elf Stack WinEvent</h2>
<p>One of our seasoned ElfSOC analysts told me about a great resource to have handy when hunting through event log data. I have it around here somewhere, or maybe it was online. Hmm.</p>
<h2 id="hint-4-elf-stack-powershell">Hint 4 - Elf Stack PowerShell</h2>
<p>Our Elf Stack SIEM has some minor issues when parsing log data that we still need to figure out. Our ElfSOC SIEM engineers drank many cups of hot chocolate figuring out the right parsing logic. The engineers wanted to ensure that our junior analysts had a solid platform to hunt through log data.</p>
<h2 id="hint-5-elf-stack-hard-email1">Hint 5 - Elf Stack Hard - Email1</h2>
<p>I was on my way to grab a cup of hot chocolate the other day when I overheard the reindeer talking about playing games. The reindeer mentioned trying to invite Wombley and Alabaster to their games. This may or may not be great news. All I know is, the reindeer better create formal invitations to send to both Wombley and Alabaster.</p>
<h2 id="hint-6-elf-stack-hard-email2">Hint 6 - Elf Stack Hard - Email2</h2>
<p>Some elves have tried to make tweaks to the Elf Stack log parsing logic, but only a seasoned SIEM engineer or analyst may find that task useful.</p>
<h2 id="access-to-the-challenge-environment-set-up">Access to the Challenge - Environment set up</h2>
<p>Upon accessing the challenge, we get the following instructions:</p>
<p><img alt="Instructions" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-1.png" /></p>
<p>If we close the initial window and click “Help”, the following text is displayed:</p>
<div style="font-family: Arial, sans-serif; line-height: 1.6; padding: 20px; border: 1px solid #ccc; border-radius: 10px; background-color: #f9f9f9;">
  <h2 style="color: #2c3e50;">Elf Stack Help</h2>
  <h3 style="color: #34495e;">Description</h3>
  <p>
    Help the ElfSOC analysts and test your technical and security skills while you investigate a malicious attack. You will parse a set of log files to identify the malicious attack vector and various events within an attack chain.
  </p>
  <p>
    The log parsing skills emphasized by this challenge can be done with the provided containerized Elf Stack SIEM, through traditional Linux CLI tools, or however you want. There are two challenge modes (<strong>EASY</strong> and <strong>HARD</strong>) which determine the difficulty of questions presented to you.
  </p>
  <p>
    <strong>Note:</strong> You do not have to use the containerized SIEM to solve any of the questions, but it might make things a bit easier! You can download the containerized Elf Stack SIEM configuration and log files by selecting the "Download" button.
  </p>

  <h3 style="color: #34495e;">Challenge Modes</h3>
  <h4 style="color: #2c3e50;">Easy Mode</h4>
  <p>
    This mode teaches basic log parsing with a common SIEM utility like the ELK stack. You are provided a Docker Compose configuration that allows you to fully setup an ELK stack within a containerized environment.
  </p>
  <p>
    Select this mode if you are new to security, or you want to continue on with the story. This mode is meant to help you learn while doing.
  </p>

  <h4 style="color: #2c3e50;">Hard Mode</h4>
  <p>
    This mode expects you have some knowledge on parsing log files. The attack path is more complex and you will need to research how to identify the steps within the attack chain.
  </p>
  <p>
    Select this mode if you want to challenge your security skills.
  </p>

  <h3 style="color: #34495e;">Optional: Elf Stack SIEM</h3>
  <h4 style="color: #2c3e50;">Containerized ELK Stack</h4>
  <p>
    The containerized SIEM is provided to assist in solving the challenge. The SIEM is fully functional and configured to ingest the provided log files.
  </p>
  <p>
    <strong>Note:</strong> This was built and tested on an Ubuntu 22.04 Linux virtual machine.
  </p>

  <h4 style="color: #2c3e50;">Containerized ELK Stack: Prerequisites</h4>
  <ul>
    <li>RAM: Minimum 16GB</li>
    <li>CPU Cores: Minimum 4</li>
    <li>Hard drive space: Minimum 30GB / Recommended 40GB</li>
    <li>A network interface with internet connectivity</li>
  </ul>
  <p>
    Follow the instructions on <a href="https://www.docker.com/">Docker Installation Guide</a> to install Docker on your respective platform.
  </p>
  <p>
    After installation of Docker, download the Elf Stack files from the download page. Unzip/Extract the containerized files into a single directory.
  </p>

  <h4 style="color: #2c3e50;">Containerized ELK Stack: Setup</h4>
  <p><strong>Note:</strong> Setup time depends on internet connectivity and system resources.</p>
  <ol>
    <li>
      Browse to the directory containing the container SIEM files and setup the environment. Time to complete ~2-10 minutes:<br>
      <code>docker compose up setup</code>
    </li>
    <li>
      Run the ELF Stack SIEM to automatically ingest the logs. Time to complete ~20-30 minutes:<br>
      <code>docker compose up</code>
    </li>
  </ol>
  <p>
    The terminal output will display:
    <ul>
      <li>When logs ingestion is complete.</li>
      <li>The login URL and credentials.</li>
    </ul>
  </p>
  <p>
    <strong>Note:</strong> After your Elf Stack SIEM is setup, ensure you set the timeframe to look at events in 2024.
  </p>

  <h4 style="color: #2c3e50;">Containerized ELK Stack: Teardown</h4>
  <p>
    Use the following command to shut down the Elf Stack SIEM:<br>
    <code>docker compose down --volumes</code>
  </p>
  <p>
    <strong>Note:</strong> The command requires the <code>--volumes</code> syntax to clear the volume data which may skew your results if you set the stack up again later.
  </p>
</div>

<p>If we click download, we get the following files:</p>
<p>https://hhc24-elfstack.holidayhackchallenge.com/download_file/log_chunk_2.log.zip<br>
https://hhc24-elfstack.holidayhackchallenge.com/download_file/elf-stack-siem-with-logs.zip<br>
https://hhc24-elfstack.holidayhackchallenge.com/download_file/log_chunk_1.log.zip</p>
<p>Following the instructions, I downloaded Ubuntu 22.04 and created a VM with 16GB of RAM and 80GB HDD space, with 4 cores and 2 threads per core.</p>
<p>To install docker in Ubuntu, I followed the official guide provided at the Docker site. Below are the commands I executed in the terminal:</p>
<pre><code># Add Docker's official GPG key:
sudo apt-get update
sudo apt-get install ca-certificates curl
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.asc

# Add the repository to Apt sources:
echo \
  &quot;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
  $(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;) stable&quot; | \
  sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
sudo apt-get update

sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
</code></pre>
<p>To test it works as expected, you can execute the following:</p>
<pre><code>sudo docker run hello-world
</code></pre>
<p>If all works as expected, we can run the container provided. Go to the "elf-stack-siem" folder and execute:</p>
<pre><code>sudo docker compose up setup
</code></pre>
<p>Once the set up is completed, execute:</p>
<pre><code>sudo docker compose up
</code></pre>
<p>If all goes well, you will eventually see the below:</p>
<p><img alt="ELK Booting" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-7.png" /></p>
<p>Grab a coffee because the log ingestion will take a while... once completed, this is what you will see:</p>
<p><img alt="ELK Ready" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-8.png" /></p>
<p>Now we can access ELK at <code>http://localhost:5601/</code></p>
<p>Username: elastic Password: ELFstackLogin!</p>
<p>Once you log in, to do a search, on the left, click "Discover". Then make sure you set the timeframe. I used from 1 January 2024 till now:</p>
<p><img alt="Timeframe" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-10.png" /></p>
<h1 id="solution-silver-easy-mode"><strong>Solution - Silver (Easy Mode)</strong></h1>
<p><strong>Note</strong>: I used ES/QL languate in Elastic for the queries.</p>
<h3 id="question-1">Question 1</h3>
<p><strong>How many unique values are there for the event_source field in all logs?</strong></p>
<p>While waiting for the set up to get ready, I started solving questions with the command line. Below is a truncated example of a log line:</p>
<pre><code>log_chunk_1.log:&lt;134&gt;1 2024-09-15T01:35:01-04:00 SleighRider.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-15T01:35:01.000000Z&quot;, &quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;, &quot;Keywords&quot;: -9223372036854775808, &quot;EventType&quot;: &quot;AUDIT_SUCCESS&quot;, ...&quot;}
</code></pre>
<p>In this example, the <code>event_source</code> is <code>WindowsEvent</code>. We can use awk to extract that specific column and count the unique values:</p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | awk -F' ' '{print $4}' | sort -u | wc -l
</code></pre>
<p><strong>Using ES/QL:</strong></p>
<p>We can do the following query:</p>
<pre><code>from logs-generic-default | stats count () by event_source
</code></pre>
<p>Or refine even further and get only the final number as result:</p>
<pre><code>from logs-generic-default | stats count_distinct(event_source)
</code></pre>
<p>Answer: <strong>5</strong></p>
<h3 id="question-2">Question 2</h3>
<p><strong>Which event_source has the fewest number of events related to it?</strong></p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | awk -F' ' '{print $4}' | sort | uniq -c | sort -n | head -n 1
</code></pre>
<p>The output of that command is: <code>269 AuthLog</code></p>
<p>Answer: <strong>AuthLog</strong></p>
<h3 id="question-3">Question 3</h3>
<p><strong>Using the event_source from the previous question as a filter, what is the field name that contains the name of the system the log event originated from?</strong></p>
<p>For this one, I simply checked one log as example:</p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | grep &quot;AuthLog&quot; | less

&lt;134&gt;1 2024-09-15T03:25:01-04:00 kringleSSleigH AuthLog - - - {&quot;timestamp&quot;: &quot;2024-09-15T06:25:01.801358-04:00&quot;, &quot;hostname&quot;: &quot;kringleSSleigH&quot;, &quot;service&quot;: &quot;CRON[5032]:&quot;, &quot;message&quot;: &quot;pam_unix(cron:session): session closed for user root&quot;}
</code></pre>
<p>Answer: <strong>hostname</strong></p>
<h3 id="question-4">Question 4</h3>
<p><strong>Which event_source has the second highest number of events related to it?</strong></p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | awk -F' ' '{print $4}' | sort | uniq -c | sort -n              
    269 AuthLog
   1398 SnowGlowMailPxy
   7476 GreenCoat
  34679 NetflowPmacct
2299324 WindowsEvent
</code></pre>
<p>Answer: <strong>NetflowPmacct</strong></p>
<h3 id="question-5">Question 5</h3>
<p><strong>Using the event_source from the previous question as a filter, what is the name of the field that defines the destination port of the Netflow logs?</strong></p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | grep &quot;NetflowPmacct&quot; | less


&lt;134&gt;1 2024-09-15T10:37:43-04:00 kringleconnect NetflowPmacct - - - {&quot;event_type&quot;: &quot;purge&quot;, &quot;ip_src&quot;: &quot;172.24.25.25&quot;, &quot;ip_dst&quot;: &quot;142.250.191.166&quot;, &quot;port_src&quot;: 51858, &quot;port_dst&quot;: 443, &quot;ip_proto&quot;: &quot;tcp&quot;, &quot;timestamp_start&quot;: &quot;2024-09-15T10:37:43-04:00&quot;, &quot;timestamp_end&quot;: &quot;0000-00-00T00:00:00-00:00&quot;, &quot;packets&quot;: 1, &quot;bytes&quot;: 79, &quot;src_host&quot;: &quot;&quot;, &quot;dst_host&quot;: &quot;&quot;}
</code></pre>
<p>Answer: <strong>port_dst</strong></p>
<h3 id="question-6">Question 6</h3>
<p><strong>Which event_source is related to email traffic?</strong></p>
<p>From the names of the event_source fields, likely to be SnowGlowMailPxy, but let's check some examples to confirm:</p>
<pre><code>cat log_chunk_1.log log_chunk_2.log | grep &quot;SnowGlowMailPxy&quot; | less


&lt;134&gt;1 2024-09-15T08:37:41-04:00 SecureElfGwy SnowGlowMailPxy - - - {&quot;From&quot;: &quot;elf_user02@northpole.local&quot;, &quot;To&quot;: &quot;wcub101@northpole.local&quot;, &quot;Subject&quot;: &quot;Meeting Schedules Update&quot;, &quot;Date&quot;: null, &quot;Message-ID&quot;: &quot;&lt;96D21546-EC3F-4BFE-9358-C7CE74705F83@SecureElfGwy.northpole.local&gt;&quot;, &quot;Return-Path&quot;: &quot;elf_user02@northpole.local&quot;, &quot;Body&quot;: &quot;Dear wcub101,\n\nI hope this email finds you in high spirits. I am reaching out to provide you with an update regarding the upcoming meeting schedules within our organization.\n\nFirstly, I want to highlight an adjustment in the date and time of the weekly team meeting. Based on the feedback received and to accommodate everyone's availability, we have decided to shift the meeting from its current slot on Mondays at 9 AM to Tuesdays at 10 AM. This change will be implemented starting next week, and I kindly request that you adjust your calendars accordingly.\n\nAdditionally, I would like to remind you about the monthly departmental meeting scheduled for this Thursday at 3 PM. The purpose of this meeting is to discuss the progress on ongoing projects, address any concerns, and share updates on overall company performance. We highly encourage your active participation to ensure effective communication across all teams.\n\nFurthermore, the bi-weekly cross-departmental meeting, where representatives from different teams come together to collaborate and share insights, will take place on Friday at 2 PM. This meeting aims to foster a sense of cohesion and synergy among departments, enabling us to work seamlessly towards our common goals.\n\nLastly, for those involved in the client acquisition project, there will be a special client meeting scheduled for next Monday at 11 AM. This meeting will serve to review the progress made, discuss potential strategies, and address any client-related queries or issues. Kindly come prepared with the necessary documentation and key insights, as it is crucial that we maintain a high level of professionalism during these interactions.\n\nIf you have any conflicts with the schedules mentioned above or require any adjustments, please let me know at your earliest convenience. We understand the importance of ensuring the availability and participation of all team members and will strive to accommodate any legitimate conflicts whenever possible.\n\nThank you for your continued dedication and contribution to the North Pole. Should you have any questions or concerns regarding the meetings or any other matter, please do not hesitate to reach out to me.\n\nLooking forward to fruitful discussions and collaborations in the meetings ahead.\n\nBest regards,\n\nelf_user02\n&quot;, &quot;Received_Time&quot;: &quot;2024-09-15T08:37:41-04:00&quot;, &quot;ReceivedIP1&quot;: &quot;172.24.25.25&quot;, &quot;ReceivedIP2&quot;: &quot;172.24.25.20&quot;}
</code></pre>
<p>Answer: <strong>SnowGlowMailPxy</strong></p>
<h3 id="question-7">Question 7</h3>
<p><strong>Looking at the event source from the last question, what is the name of the field that contains the actual email text?</strong></p>
<p>Using the same example as for question 6, we can see that the answer is "Body".</p>
<p>Answer: <strong>Body</strong></p>
<h3 id="question-8">Question 8</h3>
<p><strong>Using the 'GreenCoat' event_source, what is the only value in the hostname field?</strong></p>
<p>Example log:</p>
<p><img alt="GreenCoat Example" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-9.png" /></p>
<pre><code>grep &quot;GreenCoat&quot; log_chunk_* | awk -F' ' '{print $3}' | sort -u
</code></pre>
<p>Answer: <strong>SecureElfGwy</strong></p>
<h3 id="question-9">Question 9</h3>
<p><strong>Using the 'GreenCoat' event_source, what is the name of the field that contains the site visited by a client in the network?</strong></p>
<p>Logs from GreenCoat look like this:</p>
<pre><code>log_chunk_1.log:&lt;134&gt;1 2024-09-15T06:00:51-04:00 SecureElfGwy GreenCoat - - - {&quot;ip&quot;: &quot;172.24.25.93&quot;, &quot;user_identifier&quot;: &quot;elf_user03&quot;, &quot;timestamp&quot;: &quot;2024-09-15T06:00:51-04:00&quot;, &quot;method&quot;: &quot;CONNECT&quot;, &quot;url&quot;: &quot;disc601.prod.do.dsp.mp.microsoft.com:443&quot;, &quot;http_protocol&quot;: &quot;HTTP/1.1&quot;, &quot;status_code&quot;: 200, &quot;response_size&quot;: 0, &quot;protocol&quot;: &quot;HTTPS&quot;, &quot;additional_info&quot;: &quot;outgoing via 172.24.25.25&quot;, &quot;host&quot;: &quot;SnowSentry&quot;}
</code></pre>
<p>We can also use the following ELK query to get example logs:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;GreenCoat&quot;
</code></pre>
<p>Answer: <strong>url</strong></p>
<h3 id="question-10">Question 10</h3>
<p><strong>Using the 'GreenCoat' event_source, which unique URL and port (URL:port) did clients in the TinselStream network visit most?</strong></p>
<pre><code>from logs-generic-default
| where event_source == &quot;GreenCoat&quot; | stats count() by (event.url) | sort `count()` DESC
</code></pre>
<div style="text-align: center;">
  <img src="/images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-12.png" alt="GreenCoat Most Visited URL" border-radius: 10px;">
  <p><em>GreenCoat Most Visited URL</em></p>
</div>

<p>Answer: <strong>pagead2.googlesyndication.com:443</strong></p>
<h3 id="question-11">Question 11</h3>
<p><strong>Using the 'WindowsEvent' event_source, how many unique Channels is the SIEM receiving Windows event logs from?</strong></p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; | STATS COUNT_DISTINCT(event.Channel)
</code></pre>
<p>Answer: <strong>5</strong></p>
<h3 id="question-12">Question 12</h3>
<p><strong>What is the name of the event.Channel (or Channel) with the second highest number of events?</strong></p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; | stats count() by (event.Channel) | sort `count()` DESC
</code></pre>
<p>Answer: <strong>Microsoft-Windows-Sysmon/Operational</strong></p>
<h3 id="question-13">Question 13</h3>
<p><strong>Our environment is using Sysmon to track many different events on Windows systems. What is the Sysmon Event ID related to loading of a driver?</strong></p>
<p>According to Google, it is Event 6 (Driver Loaded).</p>
<p>Answer: <strong>6</strong></p>
<h3 id="question-14">Question 14</h3>
<p><strong>What is the Windows event ID that is recorded when a new service is installed on a system?</strong></p>
<p>Again Google: Event ID 4697.</p>
<p>Answer: <strong>4697</strong></p>
<h3 id="question-15">Question 15</h3>
<p><strong>Using the WindowsEvent event_source as your initial filter, how many user accounts were created?</strong></p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.EventID == 4720
</code></pre>
<p>There's no results.</p>
<p>Answer: <strong>0</strong></p>
<p>That's all that was needed for Silver.</p>
<h1 id="solution-gold-hard-mode"><strong>Solution - Gold (Hard Mode)</strong></h1>
<h3 id="question-1_1">Question 1</h3>
<p><strong>What is the event.EventID number for Sysmon event logs relating to process creation?</strong></p>
<p>From google: Event ID 1 - Description: "Process creation"</p>
<p>Answer: 1</p>
<h3 id="question-2_1">Question 2</h3>
<p><strong>How many unique values are there for the 'event_source' field in all of the logs?</strong></p>
<p>Same as Q1 Silver.</p>
<pre><code>from logs-generic-default | stats count_distinct(event_source)
</code></pre>
<p>Answer: <strong>5</strong></p>
<h3 id="question-3_1">Question 3</h3>
<p><strong>What is the event_source name that contains the email logs?</strong></p>
<p>Same as Q6 Silver.</p>
<p>Answer: <strong>SnowGlowMailPxy</strong></p>
<h3 id="question-4_1">Question 4</h3>
<p><strong>The North Pole network was compromised recently through a sophisticated phishing attack sent to one of our elves. The attacker found a way to bypass the middleware that prevented phishing emails from getting to North Pole elves. As a result, one of the Received IPs will likely be different from what most email logs contain. Find the email log in question and submit the value in the event 'From:' field for this email log event.</strong></p>
<p>The first thing I did is to review the log fields using:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
</code></pre>
<p>I noticed that there's 2 Received IP fields: <code>event.ReceivedIP1</code> and <code>event.ReceivedIP2</code></p>
<p>I did a count of the IPs for each field:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot; | STATS COUNT() by (event.ReceivedIP1)
</code></pre>
<p>Only one IP in the result from the above query: 172.24.25.25</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot; | STATS COUNT() by (event.ReceivedIP2)
</code></pre>
<p>2 results:
172.24.25.20
34.30.110.62</p>
<p>The second IP has only 1 hit, so that's the one we are interested in. Let's search the event where that IP is present:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot; and event.ReceivedIP2 == &quot;34.30.110.62&quot;
</code></pre>
<p>The data from the email body is interesting:</p>
<pre style="white-space: pre-wrap; word-wrap: break-word; background-color: #f5f5f5;">
We need to store the updated naughty and nice list somewhere secure. I posted it here http://hollyhaven.snowflake/howtosavexmas.zip. Act quickly so I can remove the link from the internet! I encrypted it with the password: n&nli$t_finAl1\n\nthx!\nkris\n- Sent from the sleigh. Please excuse any Ho Ho Ho's.
</pre>

<p>But the answer to the question is in the 'From' field: kriskring1e@northpole.local </p>
<p>Answer: <strong>kriskring1e@northpole.local</strong></p>
<h3 id="question-5_1">Question 5</h3>
<p><strong>Our ElfSOC analysts need your help identifying the hostname of the domain computer that established a connection to the attacker after receiving the phishing email from the previous question. You can take a look at our GreenCoat proxy logs as an event source. Since it is a domain computer, we only need the hostname, not the fully qualified domain name (FQDN) of the system.</strong></p>
<p>The body of the email mentions the following URL: <code>hollyhaven.snowflake</code>. Let's check the proxy for any connections towards that URL:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;GreenCoat&quot; and event.url like &quot;*hollyhaven.snowflake*&quot;
</code></pre>
<p>There's only one result (log below truncated):</p>
<pre><code>{
  &quot;@timestamp&quot;: &quot;2024-09-15T14:36:26.000Z&quot;,
  &quot;data_stream.type&quot;: &quot;logs&quot;,
  &quot;event.additional_info&quot;: &quot;outgoing via 172.24.25.25&quot;,
  &quot;event.host&quot;: &quot;SleighRider&quot;,
  &quot;event.http_protocol&quot;: &quot;HTTP/1.1&quot;,
  &quot;event.ip&quot;: &quot;172.24.25.12&quot;,
  &quot;event.method&quot;: &quot;GET&quot;,
  &quot;event.status_code&quot;: 200,
  &quot;event.url&quot;: &quot;http://hollyhaven.snowflake/howtosavexmas.zip&quot;,
  &quot;event.user_identifier&quot;: &quot;elf_user02&quot;,
  &quot;event_source&quot;: &quot;GreenCoat&quot;,
  &quot;host.ip&quot;: &quot;172.18.0.5&quot;,
  &quot;hostname&quot;: &quot;SecureElfGwy&quot;,
}
</code></pre>
<p>Answer: <strong>SleighRider</strong></p>
<h3 id="question-6_1">Question 6</h3>
<p><strong>What was the IP address of the system you found in the previous question?</strong></p>
<p>Checking the data in the same search result as for Question 5:</p>
<p>Answer: <strong>172.24.25.12</strong></p>
<h3 id="question-7_1">Question 7</h3>
<p><strong>A process was launched when the user executed the program AFTER they downloaded it. What was that Process ID number (digits only please)?</strong></p>
<p>Step 1 is to establish when the file was downloaded. This can be done by using event ID 11 (File Creation):</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.Hostname == &quot;SleighRider.northpole.local&quot; and event.EventID == 11 and event.TargetFilename like &quot;*howtosavexmas.zip*&quot;
</code></pre>
<p>The following is the truncated result showing interesting information:</p>
<pre><code>{
  &quot;@timestamp&quot;: &quot;2024-09-15T14:36:55.000Z&quot;,
  &quot;event.Category&quot;: &quot;File created (rule: FileCreate)&quot;,
  &quot;event.Channel&quot;: &quot;Microsoft-Windows-Sysmon/Operational&quot;,
  &quot;event.CreationUtcTime&quot;: &quot;2024-09-15T10:36:55-04:00&quot;,
  &quot;event.EventID&quot;: 11,
  &quot;event.Hostname&quot;: &quot;SleighRider.northpole.local&quot;,
  &quot;event.Image&quot;: &quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe&quot;,
  &quot;event.TargetFilename&quot;: &quot;C:\\Users\\elf_user02\\Downloads\\howtosavexmas.zip:Zone.Identifier&quot;,
  &quot;event.User&quot;: &quot;NORTHPOLE\\elf_user02&quot;,
  &quot;event_source&quot;: &quot;WindowsEvent&quot;,
  &quot;host.ip&quot;: &quot;172.18.0.5&quot;,
}
</code></pre>
<p>We can see that the user downloaded the zip file. The next thing I did is to do this query for file creation around the same time frame:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.Hostname == &quot;SleighRider.northpole.local&quot; and event.EventID == 1 
</code></pre>
<p>I also used the help of grep: </p>
<pre><code>grep &quot;SleighRider&quot; log_chunk_* | grep -i '&quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;' | grep howtosavexmas
</code></pre>
<p>Truncated log:</p>
<pre><code>  &quot;@timestamp&quot;: &quot;2024-09-15T14:36:36.000Z&quot;,
  &quot;event.CommandLine&quot;: &quot;\&quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\&quot; --single-argument http://hollyhaven.snowflake/howtosavexmas.zip&quot;,
  &quot;event.EventID&quot;: 1,
  &quot;event.Hostname&quot;: &quot;SleighRider.northpole.local&quot;,
  &quot;event.Image&quot;: &quot;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe&quot;,
  &quot;event.ParentUser&quot;: &quot;NORTHPOLE\\elf_user02&quot;,
  &quot;event.ProcessGuid&quot;: &quot;{face0b26-4224-660c-d80f-000000000700}&quot;,
  &quot;event.ProcessID&quot;: 10014,
  &quot;event.ProcessId&quot;: 5272,
  &quot;event.Product&quot;: &quot;Google Chrome&quot;,
}
</code></pre>
<p>Answer: <strong>10014</strong></p>
<p>For this question, I ended up doing a lot of unnecessary queries for the answer, but the results to those queries gave me useful information to better understand the attack. For example:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.Hostname == &quot;SleighRider.northpole.local&quot; and event.EventID == 11
</code></pre>
<p><strong>Note</strong>: for the search time frame I used "2024-09-15T14:36:55.000Z" as start date (the time at which the file was downloaded).</p>
<p>The reason I did that query is that the downloaded file was a .zip, so my thought process was that likely another file was created when it was unzipped. And sure enough, I saw the following interesting log:</p>
<pre><code>{
  &quot;@timestamp&quot;: &quot;2024-09-15T14:37:09.000Z&quot;,
  &quot;event.CreationUtcTime&quot;: &quot;2024-09-15T10:37:09-04:00&quot;,
  &quot;event.EventID&quot;: 11,
  &quot;event.TargetFilename&quot;: &quot;C:\\Users\\elf_user02\\Downloads\\howtosavexmas\\howtosavexmas.pdf.exe&quot;,
  &quot;event.User&quot;: &quot;NORTHPOLE\\elf_user02&quot;,
  &quot;host.ip&quot;: &quot;172.18.0.5&quot;,
  &quot;hostname&quot;: &quot;SleighRider.northpole.local&quot;,
}
</code></pre>
<p>So it looks like ' howtosavexmas.pdf.exe' is the malicious file we are interested in. Now we can check when a process was created using this file by searching for event id 4688 (a new process has been created) and after the time stamp in the log above:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.Hostname == &quot;SleighRider.northpole.local&quot; and event.EventID == 4688 and event.NewProcessName like &quot;*howtosavexmas*&quot;
</code></pre>
<p>Truncated log:</p>
<pre><code>{
  &quot;@timestamp&quot;: &quot;2024-09-15T14:37:50.000Z&quot;,
  &quot;event.Category&quot;: &quot;Process Creation&quot;,
  &quot;event.Channel&quot;: &quot;Security&quot;,
  &quot;event.CreatorSubject_AccountDomain&quot;: &quot;NORTHPOLE&quot;,
  &quot;event.CreatorSubject_AccountName&quot;: &quot;SLEIGHRIDER$&quot;,
  &quot;event.EventID&quot;: 4688,
  &quot;event.Hostname&quot;: &quot;SleighRider.northpole.local&quot;,
  &quot;event.NewProcessName&quot;: &quot;C:\\Users\\elf_user02\\Downloads\\howtosavexmas\\howtosavexmas.pdf.exe&quot;,
  &quot;event.ParentProcessName&quot;: &quot;C:\\Windows\\explorer.exe&quot;,
  &quot;event.ProcessID&quot;: 4,
  &quot;event.ProcessInformation&quot;: &quot;Process Command Line:,&quot;,
  &quot;event.ProcessInformation_NewProcessName&quot;: &quot;C:\\Users\\elf_user02\\Downloads\\howtosavexmas\\howtosavexmas.pdf.exe&quot;,
  &quot;event.ProcessInformation_TokenElevationType&quot;: &quot;%%1937&quot;,
  &quot;event.SourceName&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;,
  &quot;event.SubjectDomainName&quot;: &quot;NORTHPOLE&quot;,
  &quot;event.SubjectUserName&quot;: &quot;SLEIGHRIDER$&quot;,
  &quot;event.TargetDomainName&quot;: &quot;NORTHPOLE&quot;,
  &quot;event.TargetSubject_AccountName&quot;: &quot;elf_user02&quot;,
  &quot;event.TargetUserName&quot;: &quot;elf_user02&quot;,
  &quot;event.TargetUserSid&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1110&quot;,
  &quot;event.Task&quot;: 13312,
  &quot;event.ThreadID&quot;: 1460,
  &quot;event_source&quot;: &quot;WindowsEvent&quot;,
  &quot;host.ip&quot;: &quot;172.18.0.5&quot;,
  &quot;hostname&quot;: &quot;SleighRider.northpole.local&quot;,
}
</code></pre>
<p>Again, not useful for this question, but I found it interesting.</p>
<h3 id="question-8_1">Question 8</h3>
<p><strong>Did the attacker's payload make an outbound network connection? Our ElfSOC analysts need your help identifying the destination TCP port of this connection.</strong></p>
<p>From command line it was easier. I followed the trail of the events for the file using the following command until I located the log with the information I needed:</p>
<pre><code>grep &quot;SleighRider&quot; log_chunk_* | grep -i '&quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;' | grep howtosavexmas


log_chunk_1.log:&lt;134&gt;1 2024-09-15T10:37:50-04:00 SleighRider.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-15 10:37:50&quot;, &quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;, &quot;Keywords&quot;: -9214364837600034816, &quot;EventType&quot;: &quot;AUDIT_SUCCESS&quot;, &quot;SeverityValue&quot;: 2, &quot;Severity&quot;: &quot;INFO&quot;, &quot;EventID&quot;: 5156, &quot;SourceName&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;ProviderGuid&quot;: &quot;{54849625-5478-4994-A5BA-3E3B0328C30D}&quot;, &quot;Version&quot;: 1, &quot;Task&quot;: 12810, &quot;OpcodeValue&quot;: 0, &quot;RecordNumber&quot;: 734596, &quot;ProcessID&quot;: 4, &quot;ThreadID&quot;: 1460, &quot;Channel&quot;: &quot;Security&quot;, &quot;Category&quot;: &quot;Filtering Platform Connection&quot;, &quot;Opcode&quot;: &quot;Info&quot;, &quot;Application&quot;: &quot;\\device\\harddiskvolume3\\users\\elf_user02\\downloads\\howtosavexmas\\howtosavexmas.pdf.exe&quot;, &quot;Direction&quot;: &quot;%%14593&quot;, &quot;SourceAddress&quot;: &quot;172.24.25.12&quot;, &quot;SourcePort&quot;: 64543, &quot;DestAddress&quot;: &quot;103.12.187.43&quot;, &quot;DestPort&quot;: 8080, &quot;Protocol&quot;: 6, &quot;FilterRTID&quot;: 0, &quot;LayerName&quot;: &quot;%%14611&quot;, &quot;LayerRTID&quot;: 48, &quot;RemoteUserID&quot;: &quot;S-1-0-0&quot;, &quot;RemoteMachineID&quot;: &quot;S-1-0-0&quot;, &quot;EventReceivedTime&quot;: &quot;2024-09-15T10:37:50-04:00&quot;, &quot;SourceModuleName&quot;: &quot;inSecurityEvent&quot;, &quot;SourceModuleType&quot;: &quot;im_msvistalog&quot;, &quot;ApplicationInformation_ProcessID&quot;: 8096, &quot;ApplicationInformation_ApplicationName&quot;: &quot;\\device\\harddiskvolume3\\users\\elf_user02\\downloads\\howtosavexmas\\howtosavexmas.pdf.exe&quot;, &quot;NetworkInformation_Direction&quot;: &quot;Outbound&quot;, &quot;NetworkInformation_SourceAddress&quot;: &quot;172.24.25.12&quot;, &quot;NetworkInformation_SourcePort&quot;: 64543, &quot;NetworkInformation_DestinationAddress&quot;: &quot;103.12.187.43&quot;, &quot;NetworkInformation_DestinationPort&quot;: 8443, &quot;NetworkInformation_Protocol&quot;: 6, &quot;FilterInformation_FilterRunTimeID&quot;: 0, &quot;FilterInformation_LayerName&quot;: &quot;Connect&quot;, &quot;FilterInformation_LayerRunTimeID&quot;: 48, &quot;MoreDetails&quot;: &quot;The Windows Filtering Platform has permitted a connection.&quot;}
</code></pre>
<p>Answer: <strong>8443</strong></p>
<h3 id="question-9_1">Question 9</h3>
<p><strong>The attacker escalated their privileges to the SYSTEM account by creating an inter-process communication (IPC) channel. Submit the alpha-numeric name for the IPC channel used by the attacker.</strong></p>
<pre><code>grep &quot;SleighRider&quot; log_chunk_* | grep -i '&quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;' | grep &quot;pipe&quot;
</code></pre>
<p>This give us a few interesting hits and the answer:</p>
<pre><code>log_chunk_1.log:&lt;134&gt;1 2024-09-15T10:38:22-04:00 SleighRider.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-15 10:38:22&quot;, &quot;Hostname&quot;: &quot;SleighRider.northpole.local&quot;, &quot;Keywords&quot;: -9223372036854775808, &quot;EventType&quot;: &quot;INFO&quot;, &quot;SeverityValue&quot;: 2, &quot;Severity&quot;: &quot;INFO&quot;, &quot;EventID&quot;: 13, &quot;SourceName&quot;: &quot;Microsoft-Windows-Sysmon&quot;, &quot;ProviderGuid&quot;: &quot;{5770385F-C22A-43E0-BF4C-06F5698FFBD9}&quot;, &quot;Version&quot;: 2, &quot;Task&quot;: 13, &quot;OpcodeValue&quot;: 0, &quot;RecordNumber&quot;: 731, &quot;ProcessID&quot;: 10014, &quot;ThreadID&quot;: 6340, &quot;Channel&quot;: &quot;Microsoft-Windows-Sysmon/Operational&quot;, &quot;Domain&quot;: &quot;NT AUTHORITY&quot;, &quot;AccountName&quot;: &quot;SYSTEM&quot;, &quot;UserID&quot;: &quot;S-1-5-18&quot;, &quot;AccountType&quot;: &quot;User&quot;, &quot;Category&quot;: &quot;Registry value set (rule: RegistryEvent)&quot;, &quot;Opcode&quot;: &quot;Info&quot;, &quot;RuleName&quot;: &quot;T1031,T1050&quot;, &quot;UtcTime&quot;: &quot;2024-09-15T10:38:22-04:00&quot;, &quot;ProcessGuid&quot;: &quot;{face0b26-e125-6606-0b00-000000000700}&quot;, &quot;Image&quot;: &quot;C:\\Windows\\system32\\services.exe&quot;, &quot;TargetObject&quot;: &quot;HKLM\\System\\CurrentControlSet\\Services\\ddpvccdbr\\ImagePath&quot;, &quot;Details&quot;: &quot;cmd.exe /c echo ddpvccdbr &amp;gt; \\\\.\\pipe\\ddpvccdbr&quot;, &quot;User&quot;: &quot;NT AUTHORITY\\SYSTEM&quot;, &quot;EventReceivedTime&quot;: &quot;2024-09-15T10:38:22-04:00&quot;, &quot;SourceModuleName&quot;: &quot;inSysmon&quot;, &quot;SourceModuleType&quot;: &quot;im_msvistalog&quot;, &quot;ProcessId&quot;: 628, &quot;MoreDetails&quot;: &quot;Registry value set:&quot;}
</code></pre>
<p>From ELK, we can do the following query to filter by the process ID for the malicious executable (answer to question 7). Checking the logs sequence provides the answer to this question as well as other interesting information about the attacker actions:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and (event.EventID == 11 or event.EventID == 1)
| where event.ProcessID == 10014
</code></pre>
<p>Answer: <strong>ddpvccdbr</strong></p>
<h3 id="question-10_1">Question 10</h3>
<p><strong>The attacker's process attempted to access a file. Submit the full and complete file path accessed by the attacker's process.</strong></p>
<p>With a little googling I found that the interesting event IDs to search for would be:</p>
<ul>
<li>4663: An attempt was made to access an object</li>
<li>4656: A handle to an object was requested.</li>
</ul>
<p>So let's search in ELK using as additional filter the process ID we know from previous questions:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and (event.EventID == 4663 or event.EventID == 4656)
| where event.ProcessID == 10014
</code></pre>
<p>There's only one result containing the following:</p>
<pre><code> &quot;event.ObjectName&quot;: &quot;C:\\Users\\elf_user02\\Desktop\\kkringl315@10.12.25.24.pem&quot;,
</code></pre>
<p>Answer: <strong>C:\Users\elf_user02\Desktop\kkringl315@10.12.25.24.pem</strong></p>
<h3 id="question-11_1">Question 11</h3>
<p><strong>The attacker attempted to use a secure protocol to connect to a remote system. What is the hostname of the target server?</strong></p>
<p>From the previous question, we know the attacker got hold of what it is most likely an SSH Key. I initially tried searching for network events in the Windows Events:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot; and event.EventID == 3
| where event.ProcessID == 10014
</code></pre>
<p>The result shows 3 IPs, the below are the IPs and the corresponding hostnames</p>
<pre><code>172.24.25.153 - DC01.northpole.local
103.12.187.43 - 19.148.239.35.bc.googleusercontent.com
172.24.25.25 - SECUREELFGWY.northpole.local
</code></pre>
<p>However, none of those are the answer.</p>
<p>I also checked GreenCoat logs, but could not find any interesting log. I decided to go back to check what are all the sources we have available:</p>
<pre><code>    269 AuthLog
   1398 SnowGlowMailPxy
   7476 GreenCoat
  34679 NetflowPmacct
2299324 WindowsEvent
</code></pre>
<p>From the available sources, <code>AuthLog</code> is the most promising as it contains Linux authentication logs, which a login using SSH would have triggered. Nevertheless, I first grepped for the string <code>kkringl315</code> (the username as per the answer to the previous question) as follow:</p>
<pre><code>grep 'kkringl315' log_chunk_*
</code></pre>
<p>The results confirmed that the answer is likely hidden in the <code>AuthLog</code>, so I did the below query:</p>
<pre><code>from logs-generic-default | where event_source == &quot;AuthLog&quot;
| where event.service like &quot;*ssh*&quot;
</code></pre>
<p>And from there, I further refined the query:</p>
<pre><code>from logs-generic-default | where event_source == &quot;AuthLog&quot;
| where event.service like &quot;*ssh*&quot;
| stats count() by event.hostname
</code></pre>
<p>Only one option now.</p>
<p>Answer: <strong>kringleSSleigH</strong></p>
<h3 id="question-12_1">Question 12</h3>
<p><strong>The attacker created an account to establish their persistence on the Linux host. What is the name of the new account created by the attacker?</strong></p>
<p>It is easy to find the answer with grep:</p>
<pre><code>grep 'AuthLog' log_chunk_* | grep 'useradd'

log_chunk_2.log:&lt;134&gt;1 2024-09-16T10:59:46-04:00 kringleSSleigH AuthLog - - - {&quot;timestamp&quot;: &quot;2024-09-16T13:59:46.121497-04:00&quot;, &quot;hostname&quot;: &quot;kringleSSleigH&quot;, &quot;service&quot;: &quot;useradd[6207]:&quot;, &quot;message&quot;: &quot;new user: name=ssdh, UID=1002, GID=1002, home=/home/ssdh, shell=/bin/bash, from=/dev/pts/6&quot;}
</code></pre>
<p>Answer: <strong>ssdh</strong></p>
<h3 id="question-13_1">Question 13</h3>
<p><strong>The attacker wanted to maintain persistence on the Linux host they gained access to and executed multiple binaries to achieve their goal. What was the full CLI syntax of the binary the attacker executed after they created the new user account?</strong></p>
<p>Similar to above, it is easy to find the answer with a grep command:</p>
<pre><code>grep 'AuthLog' log_chunk_* | grep 'useradd' -A 10
</code></pre>
<p>with that we can see what the attacker did after adding the user. To answer the question, this is the relevant log entry:</p>
<pre><code>log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:00:14-04:00 kringleSSleigH AuthLog - - - {&quot;timestamp&quot;: &quot;2024-09-16T14:00:14.317262-04:00&quot;, &quot;hostname&quot;: &quot;kringleSSleigH&quot;, &quot;service&quot;: &quot;sudo:&quot;, &quot;message&quot;: &quot; kkringl315 : TTY=pts/5 ; PWD=/opt ; USER=root ; COMMAND=/usr/sbin/usermod -a -G sudo ssdh&quot;}
</code></pre>
<p>Answer: <strong>/usr/sbin/usermod -a -G sudo ssdh</strong></p>
<h3 id="question-14_1">Question 14</h3>
<p><strong>The attacker enumerated Active Directory using a well known tool to map our Active Directory domain over LDAP. Submit the full ISO8601 compliant timestamp when the first request of the data collection attack sequence was initially recorded against the domain controller.</strong></p>
<p>The dc is <code>dc01.northpole.local</code></p>
<p>Grepping for windows events against the DC with Event ID 2889 (LDAP bind) will likely highlight the attack:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep 'dc01.northpole.local' | grep '&quot;EventID&quot;: 2889'
</code></pre>
<p>This is the first hit:</p>
<pre><code>log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:10:12-04:00 dc01.northpole.local WindowsEvent - - - {&quot;LogName&quot;: &quot;Directory Service&quot;, &quot;Source&quot;: &quot;Microsoft-Windows-ActiveDirectory_DomainService&quot;, &quot;EventID&quot;: 2889, &quot;Category&quot;: &quot;LDAP Interface&quot;, &quot;Level&quot;: &quot;Information&quot;, &quot;Keywords&quot;: &quot;Classic&quot;, &quot;Description&quot;: &quot;The following client performed a SASL (Negotiate/Kerberos/NTLM/Digest) LDAP bind without requesting signing (integrity verification), or performed a simple bind over a clear text (non-SSL/TLS-encrypted) LDAP connection.&quot;, &quot;Computer&quot;: &quot;dc01.northpole.local&quot;, &quot;ClientIPaddress&quot;: &quot;172.24.25.22:18598&quot;, &quot;ServicePort&quot;: 389, &quot;ServiceName&quot;: &quot;dc01.northpole.local&quot;, &quot;ServiceIpAddress&quot;: &quot;172.24.25.153&quot;, &quot;UserID&quot;: &quot;elf_user@northpole.local&quot;, &quot;BindType&quot;: &quot;0 - Simple Bind that does not support signing&quot;, &quot;Date&quot;: &quot;2024-09-16T11:10:12-04:00&quot;}
</code></pre>
<p>Answer: <strong>2024-09-16T11:10:12-04:00</strong></p>
<h3 id="question-15_1">Question 15</h3>
<p><strong>The attacker attempted to perform an ADCS ESC1 attack, but certificate services denied their certificate request. Submit the name of the software responsible for preventing this initial attack.</strong></p>
<p>Event ID 4886 is for certificate requests, so I started grepping for it:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep '&quot;EventID&quot;: 4886'
</code></pre>
<p>There's only one hit, and it looks suspicious:</p>
<pre><code>log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:15:12-04:00 dc01.northpole.local WindowsEvent - - - {&quot;LogName&quot;: &quot;Security&quot;, &quot;Source&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;Date&quot;: &quot;2024-09-16T11:15:12-04:00&quot;, &quot;EventID&quot;: 4886, &quot;Category&quot;: &quot;Certification Services - Certificate Issuance&quot;, &quot;Level&quot;: &quot;Information&quot;, &quot;Keywords&quot;: &quot;Audit Success&quot;, &quot;User&quot;: &quot;N/A&quot;, &quot;Computer&quot;: &quot;dc01.northpole.local&quot;, &quot;Description&quot;: &quot;A certificate was issued to a user.&quot;, &quot;UserInformation_UserName&quot;: &quot;elf_user@northpole.local&quot;, &quot;UserInformation_UPN&quot;: &quot;nutcrakr@northpole.local&quot;, &quot;CertificateInformation_CertificateAuthority&quot;: &quot;elf-dc01-SeaA&quot;, &quot;CertificateInformation_CertificateTemplate&quot;: &quot;ElfUsers&quot;, &quot;AdditionalInformation_RequesterComputer&quot;: &quot;10.12.25.24&quot;, &quot;AdditionalInformation_CallerComputer&quot;: &quot;172.24.25.153&quot;}
</code></pre>
<p>So my next step was to check what logs were before or after that one:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep '&quot;EventID&quot;: 4886' -A 10 -B 10
</code></pre>
<p>And sure enough, one of the entries contains the answer:</p>
<pre><code>log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:14:12-04:00 dc01.northpole.local WindowsEvent - - - {&quot;LogName&quot;: &quot;Security&quot;, &quot;Source&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;Date&quot;: &quot;2024-09-16T11:14:12-04:00&quot;, &quot;EventID&quot;: 4888, &quot;Category&quot;: &quot;Certification Services - Certificate Request Denied&quot;, &quot;Level&quot;: &quot;Information&quot;, &quot;Keywords&quot;: &quot;Audit Failure&quot;, &quot;User&quot;: &quot;N/A&quot;, &quot;Computer&quot;: &quot;dc01.northpole.local&quot;, &quot;Description&quot;: &quot;A certificate request was made for a certificate template, but the request was denied because it did not meet the criteria.&quot;, &quot;UserInformation_UserName&quot;: &quot;elf_user@northpole.local&quot;, &quot;CertificateInformation_CertificateAuthority&quot;: &quot;elf-dc01-SeaA&quot;, &quot;CertificateInformation_RequestedTemplate&quot;: &quot;Administrator&quot;, &quot;ReasonForRejection&quot;: &quot;KringleGuard EDR flagged the certificate request.&quot;, &quot;AdditionalInformation_RequesterComputer&quot;: &quot;10.12.25.24&quot;, &quot;AdditionalInformation_RequestedUPN&quot;: &quot;administrator@northpole.local&quot;}
</code></pre>
<p>Answer: <strong>KringleGuard</strong></p>
<h3 id="question-16">Question 16</h3>
<p><strong>We think the attacker successfully performed an ADCS ESC1 attack. Can you find the name of the user they successfully requested a certificate on behalf of?</strong></p>
<p>The same search I did for the previous question has the answer, as the first log in the output contains the successful attack:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep '&quot;EventID&quot;: 4886'

log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:15:12-04:00 dc01.northpole.local WindowsEvent - - - {&quot;LogName&quot;: &quot;Security&quot;, &quot;Source&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;Date&quot;: &quot;2024-09-16T11:15:12-04:00&quot;, &quot;EventID&quot;: 4886, &quot;Category&quot;: &quot;Certification Services - Certificate Issuance&quot;, &quot;Level&quot;: &quot;Information&quot;, &quot;Keywords&quot;: &quot;Audit Success&quot;, &quot;User&quot;: &quot;N/A&quot;, &quot;Computer&quot;: &quot;dc01.northpole.local&quot;, &quot;Description&quot;: &quot;A certificate was issued to a user.&quot;, &quot;UserInformation_UserName&quot;: &quot;elf_user@northpole.local&quot;, &quot;UserInformation_UPN&quot;: &quot;nutcrakr@northpole.local&quot;, &quot;CertificateInformation_CertificateAuthority&quot;: &quot;elf-dc01-SeaA&quot;, &quot;CertificateInformation_CertificateTemplate&quot;: &quot;ElfUsers&quot;, &quot;AdditionalInformation_RequesterComputer&quot;: &quot;10.12.25.24&quot;, &quot;AdditionalInformation_CallerComputer&quot;: &quot;172.24.25.153&quot;}
</code></pre>
<p>Answer: <strong>nutcrakr</strong></p>
<h3 id="question-17">Question 17</h3>
<p><strong>One of our file shares was accessed by the attacker using the elevated user account (from the ADCS attack). Submit the folder name of the share they accessed.</strong></p>
<p>Event ID 5140 identifies network share access. So I searched as follow:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot;
| where event.User like &quot;*nutcrakr*&quot;
| where event.EventID == 5140
</code></pre>
<p>There was no hits, so I tried with grep checking the word share, and strangely I got hits that had event ID 5140:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep &quot;nutcrakr&quot; | grep -i share

log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:18:43-04:00 dc01.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-16 11:18:43&quot;, &quot;Hostname&quot;: &quot;dc01.northpole.local&quot;, &quot;Keywords&quot;: -9214364837600034816, &quot;EventType&quot;: &quot;AUDIT_SUCCESS&quot;, &quot;SeverityValue&quot;: 2, &quot;Severity&quot;: &quot;INFO&quot;, &quot;EventID&quot;: 5140, &quot;SourceName&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;ProviderGuid&quot;: &quot;{54849625-5478-4994-A5BA-3E3B0328C30D}&quot;, &quot;Version&quot;: 1, &quot;Task&quot;: 12808, &quot;OpcodeValue&quot;: 0, &quot;RecordNumber&quot;: 498420, &quot;ProcessID&quot;: 4, &quot;ThreadID&quot;: 5692, &quot;Channel&quot;: &quot;Security&quot;, &quot;Category&quot;: &quot;File Share&quot;, &quot;Opcode&quot;: &quot;Info&quot;, &quot;SubjectUserSid&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1112&quot;, &quot;SubjectUserName&quot;: &quot;nutcrakr&quot;, &quot;SubjectDomainName&quot;: &quot;NORTHPOLE&quot;, &quot;SubjectLogonId&quot;: &quot;0xd8fdb3&quot;, &quot;ObjectType&quot;: &quot;File&quot;, &quot;IpAddress&quot;: &quot;34.30.110.62&quot;, &quot;IpPort&quot;: 53378, &quot;ShareName&quot;: &quot;\\\\*\\WishLists&quot;, &quot;ShareLocalPath&quot;: &quot;\\??\\C:\\WishLists&quot;, &quot;AccessMask&quot;: &quot;0x1&quot;, &quot;AccessList&quot;: &quot;%%4416\r\n\t\t\t\t&quot;, &quot;EventReceivedTime&quot;: &quot;2024-09-16T11:18:43-04:00&quot;, &quot;SourceModuleName&quot;: &quot;inSecurityEvent&quot;, &quot;SourceModuleType&quot;: &quot;im_msvistalog&quot;, &quot;Subject_SecurityID&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1112&quot;, &quot;Subject_AccountName&quot;: &quot;nutcrakr&quot;, &quot;Subject_AccountDomain&quot;: &quot;NORTHPOLE&quot;, &quot;Subject_LogonID&quot;: &quot;0xD8FDB3&quot;, &quot;NetworkInformation_ObjectType&quot;: &quot;File&quot;, &quot;NetworkInformation_SourceAddress&quot;: &quot;34.30.110.62&quot;, &quot;NetworkInformation_SourcePort&quot;: 53378, &quot;NetworkInformation&quot;: &quot;,&quot;, &quot;ShareInformation_ShareName&quot;: &quot;\\\\*\\WishLists&quot;, &quot;ShareInformation_SharePath&quot;: &quot;\\??\\C:\\WishLists&quot;, &quot;AccessRequestInformation_AccessMask&quot;: &quot;0x1&quot;, &quot;AccessRequestInformation_Accesses&quot;: &quot;ReadData (or ListDirectory)&quot;, &quot;AccessRequestInformation&quot;: &quot;,&quot;, &quot;MoreDetails&quot;: &quot;A network share object was accessed.&quot;}
</code></pre>
<p>Looks like not all logs were ingested by ELK, and actually, this is mentioned in the hints from the Elf. The above log has the answer:</p>
<p>Answer: <strong>WishLists</strong></p>
<h3 id="question-18">Question 18</h3>
<p><strong>The naughty attacker continued to use their privileged account to execute a PowerShell script to gain domain administrative privileges. What is the password for the account the attacker used in their attack payload?</strong></p>
<p>I used grep to locate even ID 4104 Script block logging (shows the content of executed scripts).</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep &quot;nutcrakr&quot; | grep -i 4104


log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:33:12-04:00 SleighRider.northpole.local WindowsEvent - - - {&quot;MessageNumber&quot;: 1, &quot;MessageTotal&quot;: 1, &quot;ScriptBlockText&quot;: &quot;Add-Type -AssemblyName System.DirectoryServices\n$ldapConnString = \&quot;LDAP://CN=Domain Admins,CN=Users,DC=northpole,DC=local\&quot;\n$username = \&quot;nutcrakr\&quot;\n$pswd = 'fR0s3nF1@k3_s'\n$nullGUID = [guid]'00000000-0000-0000-0000-000000000000'\n$propGUID = [guid]'00000000-0000-0000-0000-000000000000'\n$IdentityReference = (New-Object System.Security.Principal.NTAccount(\&quot;northpole.local\\$username\&quot;)).Translate([System.Security.Principal.SecurityIdentifier])\n$inheritanceType = [System.DirectoryServices.ActiveDirectorySecurityInheritance]::None\n$ACE = New-Object System.DirectoryServices.ActiveDirectoryAccessRule $IdentityReference, ([System.DirectoryServices.ActiveDirectoryRights] \&quot;GenericAll\&quot;), ([System.Security.AccessControl.AccessControlType] \&quot;Allow\&quot;), $propGUID, $inheritanceType, $nullGUID\n$domainDirEntry = New-Object System.DirectoryServices.DirectoryEntry $ldapConnString, $username, $pswd\n$secOptions = $domainDirEntry.get_Options()\n$secOptions.SecurityMasks = [System.DirectoryServices.SecurityMasks]::Dacl\n$domainDirEntry.RefreshCache()\n$domainDirEntry.get_ObjectSecurity().AddAccessRule($ACE)\n$domainDirEntry.CommitChanges()\n$domainDirEntry.dispose()\n$ldapConnString = \&quot;LDAP://CN=Domain Admins,CN=Users,DC=northpole,DC=local\&quot;\n$domainDirEntry = New-Object System.DirectoryServices.DirectoryEntry $ldapConnString, $username, $pswd\n$user = New-Object System.Security.Principal.NTAccount(\&quot;northpole.local\\$username\&quot;)\n$sid=$user.Translate([System.Security.Principal.SecurityIdentifier])\n$b=New-Object byte[] $sid.BinaryLength\n$sid.GetBinaryForm($b,0)\n$hexSID=[BitConverter]::ToString($b).Replace('-','')\n$domainDirEntry.Add(\&quot;LDAP://&lt;SID=$hexSID&gt;\&quot;)\n$domainDirEntry.CommitChanges()\n$domainDirEntry.dispose()&quot;, &quot;ScriptBlockId&quot;: &quot;{01bbe2da-58c3-4490-aa52-682dbae233a3}&quot;, &quot;Path&quot;: &quot;&quot;, &quot;Provider_Name&quot;: &quot;Microsoft-Windows-PowerShell&quot;, &quot;Provider_Guid&quot;: &quot;{a0c1853b-5c40-4b15-8766-3cf1c58f985a}&quot;, &quot;EventID&quot;: 4104, &quot;Version&quot;: 1, &quot;Level&quot;: 5, &quot;Task&quot;: 2, &quot;Opcode&quot;: 15, &quot;Keywords&quot;: &quot;0x0&quot;, &quot;TimeCreated_SystemTime&quot;: &quot;2024-09-16T11:33:12-04:00&quot;, &quot;EventRecordID&quot;: 54059, &quot;Correlation_ActivityID&quot;: &quot;{17aa0df9-5d3d-46e9-bce0-55b7a5be4b43}&quot;, &quot;ParentProcessID&quot;: 928, &quot;ThreadID&quot;: 4896, &quot;Channel&quot;: &quot;Microsoft-Windows-PowerShell/Operational&quot;, &quot;Computer&quot;: &quot;SleighRider.northpole.local&quot;, &quot;Security_UserID&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1110&quot;}
</code></pre>
<p>Answer: <strong>fR0s3nF1@k3_s</strong></p>
<h3 id="question-19">Question 19</h3>
<p><strong>The attacker then used remote desktop to remotely access one of our domain computers. What is the full ISO8601 compliant UTC EventTime when they established this connection?</strong></p>
<p>I checked Event ID 4624 (successful logon) with logon type 10 (which is specific for RDP), and there was only one hit:</p>
<p>with grep:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep '&quot;EventID&quot;: 4624' | grep '&quot;LogonType&quot;: 10'
</code></pre>
<p>with ELK:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;WindowsEvent&quot;
| where event.EventID == 4624
| where event.LogonType == 10
</code></pre>
<pre><code>log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:35:57-04:00 dc01.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-16 11:35:57&quot;, &quot;Hostname&quot;: &quot;dc01.northpole.local&quot;, &quot;Keywords&quot;: -9214364837600034816, &quot;EventType&quot;: &quot;AUDIT_SUCCESS&quot;, &quot;SeverityValue&quot;: 2, &quot;Severity&quot;: &quot;INFO&quot;, &quot;EventID&quot;: 4624, &quot;SourceName&quot;: &quot;Microsoft-Windows-Security-Auditing&quot;, &quot;ProviderGuid&quot;: &quot;{54849625-5478-4994-A5BA-3E3B0328C30D}&quot;, &quot;Version&quot;: 2, &quot;Task&quot;: 12544, &quot;OpcodeValue&quot;: 0, &quot;RecordNumber&quot;: 530313, &quot;ActivityID&quot;: &quot;{D72392BD-843F-0000-1F93-23D73F84DA01}&quot;, &quot;ProcessID&quot;: 704, &quot;ThreadID&quot;: 1124, &quot;Channel&quot;: &quot;Security&quot;, &quot;Category&quot;: &quot;Logon&quot;, &quot;Opcode&quot;: &quot;Info&quot;, &quot;SubjectUserSid&quot;: &quot;S-1-5-18&quot;, &quot;SubjectUserName&quot;: &quot;DC01$&quot;, &quot;SubjectDomainName&quot;: &quot;NORTHPOLE&quot;, &quot;SubjectLogonId&quot;: &quot;0x3e7&quot;, &quot;TargetUserSid&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1112&quot;, &quot;TargetUserName&quot;: &quot;nutcrakr&quot;, &quot;TargetDomainName&quot;: &quot;NORTHPOLE&quot;, &quot;TargetLogonId&quot;: &quot;0xdd425e&quot;, &quot;LogonType&quot;: 10, &quot;LogonProcessName&quot;: &quot;User32 &quot;, &quot;AuthenticationPackageName&quot;: &quot;Negotiate&quot;, &quot;WorkstationName&quot;: &quot;DC01&quot;, &quot;LogonGuid&quot;: &quot;{00000000-0000-0000-0000-000000000000}&quot;, &quot;TransmittedServices&quot;: &quot;-&quot;, &quot;LmPackageName&quot;: &quot;-&quot;, &quot;KeyLength&quot;: 0, &quot;ProcessName&quot;: &quot;C:\\Windows\\System32\\svchost.exe&quot;, &quot;IpAddress&quot;: &quot;10.12.25.24&quot;, &quot;IpPort&quot;: 0, &quot;ImpersonationLevel&quot;: &quot;%%1833&quot;, &quot;RestrictedAdminMode&quot;: &quot;%%1843&quot;, &quot;TargetOutboundUserName&quot;: &quot;-&quot;, &quot;TargetOutboundDomainName&quot;: &quot;-&quot;, &quot;VirtualAccount&quot;: &quot;%%1843&quot;, &quot;TargetLinkedLogonId&quot;: &quot;0xdd41af&quot;, &quot;ElevatedToken&quot;: &quot;%%1843&quot;, &quot;EventReceivedTime&quot;: &quot;2024-09-16T11:35:57-04:00&quot;, &quot;SourceModuleName&quot;: &quot;inSecurityEvent&quot;, &quot;SourceModuleType&quot;: &quot;im_msvistalog&quot;, &quot;Subject_SecurityID&quot;: &quot;S-1-5-18&quot;, &quot;Subject_AccountName&quot;: &quot;DC01$&quot;, &quot;Subject_AccountDomain&quot;: &quot;NORTHPOLE&quot;, &quot;Subject_LogonID&quot;: &quot;0x3E7&quot;, &quot;LogonInformation_LogonType&quot;: 10, &quot;LogonInformation_RestrictedAdminMode&quot;: &quot;No&quot;, &quot;LogonInformation_VirtualAccount&quot;: &quot;No&quot;, &quot;LogonInformation_ElevatedToken&quot;: &quot;No&quot;, &quot;NewLogon_SecurityID&quot;: &quot;S-1-5-21-3699322559-1991583901-1175093138-1112&quot;, &quot;NewLogon_AccountName&quot;: &quot;nutcrakr&quot;, &quot;NewLogon_AccountDomain&quot;: &quot;NORTHPOLE&quot;, &quot;NewLogon_LogonID&quot;: &quot;0xDD425E&quot;, &quot;NewLogon_LinkedLogonID&quot;: &quot;0xDD41AF&quot;, &quot;NewLogon_NetworkAccountName&quot;: &quot;-&quot;, &quot;NewLogon_NetworkAccountDomain&quot;: &quot;-&quot;, &quot;NewLogon_LogonGUID&quot;: &quot;{00000000-0000-0000-0000-000000000000}&quot;, &quot;ProcessInformation_ProcessID&quot;: &quot;0x994&quot;, &quot;ProcessInformation_ProcessName&quot;: &quot;C:\\Windows\\System32\\svchost.exe&quot;, &quot;NetworkInformation_WorkstationName&quot;: &quot;DC01&quot;, &quot;NetworkInformation_SourceNetworkAddress&quot;: &quot;10.12.25.24&quot;, &quot;NetworkInformation_SourcePort&quot;: 0, &quot;DetailedAuthenticationInformation_LogonProcess&quot;: &quot;User32&quot;, &quot;DetailedAuthenticationInformation_AuthenticationPackage&quot;: &quot;Negotiate&quot;, &quot;DetailedAuthenticationInformation_TransitedServices&quot;: &quot;-&quot;, &quot;DetailedAuthenticationInformation_PackageNameNTLMonly&quot;: &quot;-&quot;, &quot;DetailedAuthenticationInformation_KeyLength&quot;: 0, &quot;MoreDetails&quot;: &quot;An account was successfully logged on.\nThis event is generated when a logon session is created. It is generated on the computer that was accessed.\nThe subject fields indicate the account on the local system which requested the logon. This is most commonly a service such as the Server service, or a local process such as Winlogon.exe or Services.exe.\nThe logon type field indicates the kind of logon that occurred. The most common types are 2 (interactive) and 3 (network).\nThe New Logon fields indicate the account for whom the new logon was created, i.e. the account that was logged on.\nThe network fields indicate where a remote logon request originated. Workstation name is not always available and may be left blank in some cases.\nThe impersonation level field indicates the extent to which a process in the logon session can impersonate.\nThe authentication information fields provide detailed information about this specific logon request.\n- Logon GUID is a unique identifier that can be used to correlate this event with a KDC event.\n- Transited services indicate which intermediate services have participated in this logon request.\n- Package name indicates which sub-protocol was used among the NTLM protocols.\n- Key length indicates the length of the generated session key. This will be 0 if no session key was requested.&quot;}
</code></pre>
<p>Answer: <strong>2024-09-16T15:35:57.000Z</strong></p>
<h3 id="question-20">Question 20</h3>
<p><strong>The attacker is trying to create their own naughty and nice list! What is the full file path they created using their remote desktop connection?</strong></p>
<p>I saw the log as part of researching previous answers and I was pretty sure it was related to the answer for Q17, so I did a simple grep to try to locate the log again using known information like the target host and the username:</p>
<pre><code>grep &quot;WindowsEvent&quot; log_chunk_* | grep &quot;nutcrakr&quot; | grep &quot;dc01.northpole.local&quot; | grep -v '&quot;PrivilegeList&quot;: ' | grep -i list

log_chunk_2.log:&lt;134&gt;1 2024-09-16T11:36:28-04:00 dc01.northpole.local WindowsEvent - - - {&quot;EventTime&quot;: &quot;2024-09-16 11:36:28&quot;, &quot;Hostname&quot;: &quot;dc01.northpole.local&quot;, &quot;Keywords&quot;: -9223372036854775808, &quot;EventType&quot;: &quot;INFO&quot;, &quot;SeverityValue&quot;: 2, &quot;Severity&quot;: &quot;INFO&quot;, &quot;EventID&quot;: 1, &quot;SourceName&quot;: &quot;Microsoft-Windows-Sysmon&quot;, &quot;ProviderGuid&quot;: &quot;{5770385F-C22A-43E0-BF4C-06F5698FFBD9}&quot;, &quot;Version&quot;: 5, &quot;Task&quot;: 1, &quot;OpcodeValue&quot;: 0, &quot;RecordNumber&quot;: 641, &quot;ProcessID&quot;: 6468, &quot;ThreadID&quot;: 4816, &quot;Channel&quot;: &quot;Microsoft-Windows-Sysmon/Operational&quot;, &quot;Domain&quot;: &quot;NT AUTHORITY&quot;, &quot;AccountName&quot;: &quot;SYSTEM&quot;, &quot;UserID&quot;: &quot;S-1-5-18&quot;, &quot;AccountType&quot;: &quot;User&quot;, &quot;Category&quot;: &quot;Process Create (rule: ProcessCreate)&quot;, &quot;Opcode&quot;: &quot;Info&quot;, &quot;RuleName&quot;: &quot;-&quot;, &quot;UtcTime&quot;: &quot;2024-09-16T11:36:28-04:00&quot;, &quot;ProcessGuid&quot;: &quot;{f151dc49-502c-660c-8702-000000000900}&quot;, &quot;Image&quot;: &quot;C:\\Windows\\System32\\notepad.exe&quot;, &quot;FileVersion&quot;: &quot;10.0.17763.1697 (WinBuild.160101.0800)&quot;, &quot;Description&quot;: &quot;Notepad&quot;, &quot;Product&quot;: &quot;Microsoft\u00ae Windows\u00ae Operating System&quot;, &quot;Company&quot;: &quot;Microsoft Corporation&quot;, &quot;OriginalFileName&quot;: &quot;NOTEPAD.EXE&quot;, &quot;CommandLine&quot;: &quot;\&quot;C:\\Windows\\system32\\NOTEPAD.EXE\&quot; C:\\WishLists\\santadms_only\\its_my_fakelst.txt&quot;, &quot;CurrentDirectory&quot;: &quot;C:\\WishLists\\santadms_only\\&quot;, &quot;User&quot;: &quot;NORTHPOLE\\nutcrakr&quot;, &quot;LogonGuid&quot;: &quot;{f151dc49-500d-660c-5e42-dd0000000000}&quot;, &quot;LogonId&quot;: &quot;0xdd425e&quot;, &quot;TerminalSessionId&quot;: 2, &quot;IntegrityLevel&quot;: &quot;Medium&quot;, &quot;Hashes&quot;: &quot;MD5=5394096A1CEBF81AF24E993777CAABF4,SHA256=A28438E1388F272A52559536D99D65BA15B1A8288BE1200E249851FDF7EE6C7E,IMPHASH=C8922BE3DCDFEB5994C9EEE7745DC22E&quot;, &quot;ParentProcessGuid&quot;: &quot;{f151dc49-500f-660c-5902-000000000900}&quot;, &quot;ParentProcessId&quot;: 1364, &quot;ParentImage&quot;: &quot;C:\\Windows\\explorer.exe&quot;, &quot;ParentCommandLine&quot;: &quot;C:\\Windows\\Explorer.EXE&quot;, &quot;ParentUser&quot;: &quot;NORTHPOLE\\nutcrakr&quot;, &quot;EventReceivedTime&quot;: &quot;2024-09-16T11:36:28-04:00&quot;, &quot;SourceModuleName&quot;: &quot;inSysmon&quot;, &quot;SourceModuleType&quot;: &quot;im_msvistalog&quot;, &quot;ProcessId&quot;: 9152, &quot;MoreDetails&quot;: &quot;Process Create:&quot;}
</code></pre>
<p>Answer: <strong>C:\WishLists\santadms_only\its_my_fakelst.txt</strong></p>
<h3 id="question-21">Question 21</h3>
<p><strong>The Wombley faction has user accounts in our environment. How many unique Wombley faction users sent an email message within the domain?</strong></p>
<p>I initially struggled to understand the question, so I tried to work out the answer by dissecting it slowly. The question asks about emails, so I need to check the SnowGlowMailPxy source. I started by using ELK to display all the unique email addresses that were used in the logs:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
| stats count() by event.From
</code></pre>
<p>There are 571 emails, and that was not the answer. So let's dig in more into the question. It says "within the domain", so I guess we can filter by emails sent from the <code>northpole.local</code> domain:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
| where event.From like &quot;*northpole*&quot;
| stats count() by event.From
</code></pre>
<p>That give us 21 unique addresses. But that's not the answer either. Checking the results I can see the following:</p>
<p><img alt="Elf Stack Q21" src="/images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-16.png" /></p>
<p>Now I understand! Some email addresses look like using the name of Wombley Cube, suggesting these belong to the Wombley faction users. With this in mind, let's build a query that will give us the final answer:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
| where event.From like &quot;*northpole*&quot; and event.From like &quot;*cub*&quot;
| stats COUNT_DISTINCT(event.From)
</code></pre>
<p>Answer: <strong>4</strong></p>
<h3 id="question-22">Question 22</h3>
<p><strong>The Alabaster faction also has some user accounts in our environment. How many emails were sent by the Alabaster users to the Wombley faction users?</strong></p>
<p>I built this query to get the answer:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
| where event.From like &quot;*northpole*&quot; and event.From like &quot;*snow*&quot;
| where event.To like &quot;*cub*&quot;
</code></pre>
<p>The above initial query returned 23 results, but the answer was incorrect. After some back and forth trying to understand why, I modified the query to display all the unique To and From values instead:</p>
<pre><code>from logs-generic-default
| where event_source == &quot;SnowGlowMailPxy&quot;
| where event.From like &quot;*northpole*&quot; and event.From like &quot;*snow*&quot;
| where event.To like &quot;*cub*&quot;
| stats count() by event.From, event.To
</code></pre>
<p>And there it was, naughty Santa had guessed the query and added a trap:</p>
<p><img alt="Elf Stack Q22" src="/images/HHC/2024/Act%203/Elf%20Stack/Elf%20Stack-17.png" /></p>
<p>So to the previous count of 23 we need to remove that 1 email, giving us the final answer.</p>
<p>Answer: <strong>22</strong></p>
<h3 id="question-23">Question 23</h3>
<p><strong>Of all the reindeer, there are only nine. What's the full domain for the one whose nose does glow and shine? To help you narrow your search, search the events in the 'SnowGlowMailPxy' event source.</strong></p>
<p>I grepped for what I thought would make sense: <code>rudolph</code>. There was not that many emails, so I just went through the body and selected the ones that did not look like phishing or spam, got it at the second try.</p>
<pre><code>grep &quot;SnowGlowMailPxy&quot; log_chunk_* | grep -i rudolph
</code></pre>
<p>Answer: <strong>rud01ph.glow</strong></p>
<h3 id="question-24">Question 24</h3>
<p><strong>With a fiery tail seen once in great years, what's the domain for the reindeer who flies without fears? To help you narrow your search, search the events in the 'SnowGlowMailPxy' event source.</strong></p>
<p>The first challenge was to figure out the name of the Reindeer... Some Googling and some guessing suggested that maybe comet was the name I was looking for.</p>
<p>For me, the best query to find the answer was to display all unique From email addresses as follow:</p>
<pre><code>grep &quot;SnowGlowMailPxy&quot; log_chunk_* | grep -oP '&quot;From&quot;:\s*&quot;\K[^&quot;]+' | sort | uniq
</code></pre>
<p>The above command showed all the unique emails ordered alphabetically. This made easier to locate good candidates by glancing over the results.</p>
<p>Answer: <strong>c0m3t.halleys</strong></p>
<h1 id="final-message-from-fitzy-shortstack">Final Message from Fitzy Shortstack</h1>
<p>Once we complete the objective, Fitzy tell us the following:</p>
<p><img alt="Fitzy Shortstack Conversation Completion" src="../../../../../images/HHC/2024/Act%203/Elf%20Stack/Fitzy%20Shortstack-2.png" /></p>
<h1 id="challenge-answers-summary">Challenge Answers Summary</h1>
<p>Easy Mode - Silver</p>
<p>Q1: 5<br>
Q2: AuthLog<br>
Q3: hostname<br>
Q4: NetflowPmacct<br>
Q5: port_dst<br>
Q6: SnowGlowMailPxy<br>
Q7: Body<br>
Q8: SecureElfGwy<br>
Q9: url<br>
Q10: pagead2.googlesyndication.com:443<br>
Q11: 5<br>
Q12: Microsoft-Windows-Sysmon/Operational<br>
Q13: 6<br>
Q14: 4697<br>
Q15: 0</p>
<p>Hard Mode - Gold</p>
<p>Q1: 1<br>
Q2: 5<br>
Q3: SnowGlowMailPxy<br>
Q4: kriskring1e@northpole.local<br>
Q5: SleighRider<br>
Q6: 172.24.25.12<br>
Q7: 10014<br>
Q8: 8443<br>
Q9: ddpvccdbr<br>
Q10: C:\Users\elf_user02\Desktop\kkringl315@10.12.25.24.pem<br>
Q11: kringleSSleigH<br>
Q12: ssdh<br>
Q13: /usr/sbin/usermod -a -G sudo ssdh<br>
Q14: 2024-09-16T11:10:12-04:00<br>
Q15: KringleGuard<br>
Q16: nutcrakr<br>
Q17: WishLists<br>
Q18: fR0s3nF1@k3_s<br>
Q19: 2024-09-16T15:35:57.000Z<br>
Q20: C:\WishLists\santadms_only\its_my_fakelst.txt<br>
Q21: 4<br>
Q22: 22<br>
Q23: rud01ph.glow<br>
Q24: c0m3t.halleys<br></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.path"], "search": "../../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>